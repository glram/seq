

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Program Listing for File core.h &mdash; Seq 0.9.6 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/collapsible-lists/css/tree_view.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #333131" >
          

          
            <a href="../index.html" class="icon icon-home"> Seq
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cookbook.html">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python.html">Calling Python from Seq</a></li>
<li class="toctree-l1"><a class="reference internal" href="../embed.html">Calling Seq from C/C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build.html">Building from Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internals.html">Compiler Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="doxygen.html">Compiler API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Seq</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Program Listing for File core.h</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/api/program_listing_file_compiler_util_fmt_core.h.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="program-listing-for-file-core-h">
<span id="program-listing-file-compiler-util-fmt-core-h"></span><h1>Program Listing for File core.h<a class="headerlink" href="#program-listing-for-file-core-h" title="Permalink to this headline">¶</a></h1>
<p>↰ <a class="reference internal" href="file_compiler_util_fmt_core.h.html#file-compiler-util-fmt-core-h"><span class="std std-ref">Return to documentation for file</span></a> (<code class="docutils literal notranslate"><span class="pre">compiler/util/fmt/core.h</span></code>)</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Formatting library for C++ - the core API</span>
<span class="c1">//</span>
<span class="c1">// Copyright (c) 2012 - present, Victor Zverovich</span>
<span class="c1">// All rights reserved.</span>
<span class="c1">//</span>
<span class="c1">// For the license information refer to format.h.</span>

<span class="cp">#ifndef FMT_CORE_H_</span>
<span class="cp">#define FMT_CORE_H_</span>

<span class="cp">#include</span> <span class="cpf">&lt;cstdio&gt; // std::FILE</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;cstring&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iterator&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;type_traits&gt;</span><span class="cp"></span>

<span class="c1">// The fmt library version in the form major * 10000 + minor * 100 + patch.</span>
<span class="cp">#define FMT_VERSION 60102</span>

<span class="cp">#ifdef __has_feature</span>
<span class="cp">#define FMT_HAS_FEATURE(x) __has_feature(x)</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_HAS_FEATURE(x) 0</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(__has_include) &amp;&amp; !defined(__INTELLISENSE__) &amp;&amp;                    \</span>
<span class="cp">    !(defined(__INTEL_COMPILER) &amp;&amp; __INTEL_COMPILER &lt; 1600)</span>
<span class="cp">#define FMT_HAS_INCLUDE(x) __has_include(x)</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_HAS_INCLUDE(x) 0</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef __has_cpp_attribute</span>
<span class="cp">#define FMT_HAS_CPP_ATTRIBUTE(x) __has_cpp_attribute(x)</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_HAS_CPP_ATTRIBUTE(x) 0</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(__GNUC__) &amp;&amp; !defined(__clang__)</span>
<span class="cp">#define FMT_GCC_VERSION (__GNUC__ * 100 + __GNUC_MINOR__)</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_GCC_VERSION 0</span>
<span class="cp">#endif</span>

<span class="cp">#if __cplusplus &gt;= 201103L || defined(__GXX_EXPERIMENTAL_CXX0X__)</span>
<span class="cp">#define FMT_HAS_GXX_CXX11 FMT_GCC_VERSION</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_HAS_GXX_CXX11 0</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef __NVCC__</span>
<span class="cp">#define FMT_NVCC __NVCC__</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_NVCC 0</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef _MSC_VER</span>
<span class="cp">#define FMT_MSC_VER _MSC_VER</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_MSC_VER 0</span>
<span class="cp">#endif</span>

<span class="c1">// Check if relaxed C++14 constexpr is supported.</span>
<span class="c1">// GCC doesn&#39;t allow throw in constexpr until version 6 (bug 67371).</span>
<span class="cp">#ifndef FMT_USE_CONSTEXPR</span>
<span class="cp">#define FMT_USE_CONSTEXPR                                                      \</span>
<span class="cp">  (FMT_HAS_FEATURE(cxx_relaxed_constexpr) || FMT_MSC_VER &gt;= 1910 ||            \</span>
<span class="cp">   (FMT_GCC_VERSION &gt;= 600 &amp;&amp; __cplusplus &gt;= 201402L)) &amp;&amp;                      \</span>
<span class="cp">      !FMT_NVCC</span>
<span class="cp">#endif</span>
<span class="cp">#if FMT_USE_CONSTEXPR</span>
<span class="cp">#define FMT_CONSTEXPR constexpr</span>
<span class="cp">#define FMT_CONSTEXPR_DECL constexpr</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_CONSTEXPR inline</span>
<span class="cp">#define FMT_CONSTEXPR_DECL</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef FMT_OVERRIDE</span>
<span class="cp">#if FMT_HAS_FEATURE(cxx_override) ||                                           \</span>
<span class="cp">    (FMT_GCC_VERSION &gt;= 408 &amp;&amp; FMT_HAS_GXX_CXX11) || FMT_MSC_VER &gt;= 1900</span>
<span class="cp">#define FMT_OVERRIDE override</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_OVERRIDE</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="c1">// Check if exceptions are disabled.</span>
<span class="cp">#ifndef FMT_EXCEPTIONS</span>
<span class="cp">#if (defined(__GNUC__) &amp;&amp; !defined(__EXCEPTIONS)) ||                           \</span>
<span class="cp">    FMT_MSC_VER &amp;&amp; !_HAS_EXCEPTIONS</span>
<span class="cp">#define FMT_EXCEPTIONS 0</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_EXCEPTIONS 1</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="c1">// Define FMT_USE_NOEXCEPT to make fmt use noexcept (C++11 feature).</span>
<span class="cp">#ifndef FMT_USE_NOEXCEPT</span>
<span class="cp">#define FMT_USE_NOEXCEPT 0</span>
<span class="cp">#endif</span>

<span class="cp">#if FMT_USE_NOEXCEPT || FMT_HAS_FEATURE(cxx_noexcept) ||                       \</span>
<span class="cp">    (FMT_GCC_VERSION &gt;= 408 &amp;&amp; FMT_HAS_GXX_CXX11) || FMT_MSC_VER &gt;= 1900</span>
<span class="cp">#define FMT_DETECTED_NOEXCEPT noexcept</span>
<span class="cp">#define FMT_HAS_CXX11_NOEXCEPT 1</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_DETECTED_NOEXCEPT throw()</span>
<span class="cp">#define FMT_HAS_CXX11_NOEXCEPT 0</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef FMT_NOEXCEPT</span>
<span class="cp">#if FMT_EXCEPTIONS || FMT_HAS_CXX11_NOEXCEPT</span>
<span class="cp">#define FMT_NOEXCEPT FMT_DETECTED_NOEXCEPT</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_NOEXCEPT</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="c1">// [[noreturn]] is disabled on MSVC because of bogus unreachable code warnings.</span>
<span class="cp">#if FMT_EXCEPTIONS &amp;&amp; FMT_HAS_CPP_ATTRIBUTE(noreturn) &amp;&amp; !FMT_MSC_VER</span>
<span class="cp">#define FMT_NORETURN [[noreturn]]</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_NORETURN</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef FMT_DEPRECATED</span>
<span class="cp">#if (FMT_HAS_CPP_ATTRIBUTE(deprecated) &amp;&amp; __cplusplus &gt;= 201402L) ||           \</span>
<span class="cp">    FMT_MSC_VER &gt;= 1900</span>
<span class="cp">#define FMT_DEPRECATED [[deprecated]]</span>
<span class="cp">#else</span>
<span class="cp">#if defined(__GNUC__) || defined(__clang__)</span>
<span class="cp">#define FMT_DEPRECATED __attribute__((deprecated))</span>
<span class="cp">#elif FMT_MSC_VER</span>
<span class="cp">#define FMT_DEPRECATED __declspec(deprecated)</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_DEPRECATED </span><span class="cm">/* deprecated */</span><span class="cp"></span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="c1">// Workaround broken [[deprecated]] in the Intel compiler and NVCC.</span>
<span class="cp">#if defined(__INTEL_COMPILER) || FMT_NVCC</span>
<span class="cp">#define FMT_DEPRECATED_ALIAS</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_DEPRECATED_ALIAS FMT_DEPRECATED</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef FMT_BEGIN_NAMESPACE</span>
<span class="cp">#if FMT_HAS_FEATURE(cxx_inline_namespaces) || FMT_GCC_VERSION &gt;= 404 ||        \</span>
<span class="cp">    FMT_MSC_VER &gt;= 1900</span>
<span class="cp">#define FMT_INLINE_NAMESPACE inline namespace</span>
<span class="cp">#define FMT_END_NAMESPACE                                                      \</span>
<span class="cp">  }                                                                            \</span>
<span class="cp">  }</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_INLINE_NAMESPACE namespace</span>
<span class="cp">#define FMT_END_NAMESPACE                                                      \</span>
<span class="cp">  }                                                                            \</span>
<span class="cp">  using namespace v6;                                                          \</span>
<span class="cp">  }</span>
<span class="cp">#endif</span>
<span class="cp">#define FMT_BEGIN_NAMESPACE                                                    \</span>
<span class="cp">  namespace fmt {                                                              \</span>
<span class="cp">  FMT_INLINE_NAMESPACE v6 {</span>
<span class="cp">#endif</span>

<span class="cp">#if !defined(FMT_HEADER_ONLY) &amp;&amp; defined(_WIN32)</span>
<span class="cp">#ifdef FMT_EXPORT</span>
<span class="cp">#define FMT_API __declspec(dllexport)</span>
<span class="cp">#elif defined(FMT_SHARED)</span>
<span class="cp">#define FMT_API __declspec(dllimport)</span>
<span class="cp">#define FMT_EXTERN_TEMPLATE_API FMT_API</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef FMT_API</span>
<span class="cp">#define FMT_API</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef FMT_EXTERN_TEMPLATE_API</span>
<span class="cp">#define FMT_EXTERN_TEMPLATE_API</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef FMT_HEADER_ONLY</span>
<span class="cp">#define FMT_EXTERN extern</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_EXTERN</span>
<span class="cp">#endif</span>

<span class="c1">// libc++ supports string_view in pre-c++17.</span>
<span class="cp">#if (FMT_HAS_INCLUDE(&lt;string_view&gt;) &amp;&amp;                                         \</span>
<span class="cp">     (__cplusplus &gt; 201402L || defined(_LIBCPP_VERSION))) ||                   \</span>
<span class="cp">    (defined(_MSVC_LANG) &amp;&amp; _MSVC_LANG &gt; 201402L &amp;&amp; _MSC_VER &gt;= 1910)</span>
<span class="cp">#include</span> <span class="cpf">&lt;string_view&gt;</span><span class="cp"></span>
<span class="cp">#define FMT_USE_STRING_VIEW</span>
<span class="cp">#elif FMT_HAS_INCLUDE(&quot;experimental/string_view&quot;) &amp;&amp; __cplusplus &gt;= 201402L</span>
<span class="cp">#include</span> <span class="cpf">&lt;experimental/string_view&gt;</span><span class="cp"></span>
<span class="cp">#define FMT_USE_EXPERIMENTAL_STRING_VIEW</span>
<span class="cp">#endif</span>

<span class="n">FMT_BEGIN_NAMESPACE</span>

<span class="c1">// Implementations of enable_if_t and other types for pre-C++14 systems.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="kt">bool</span> <span class="n">B</span><span class="p">,</span> <span class="k">class</span> <span class="nc">T</span> <span class="o">=</span> <span class="kt">void</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">enable_if_t</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">enable_if</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="kt">bool</span> <span class="n">B</span><span class="p">,</span> <span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">F</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">conditional_t</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">conditional</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">F</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="kt">bool</span> <span class="n">B</span><span class="o">&gt;</span> <span class="k">using</span> <span class="n">bool_constant</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span> <span class="n">B</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">remove_reference_t</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">remove_reference</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">remove_const_t</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">remove_const</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">remove_cvref_t</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">remove_cv</span><span class="o">&lt;</span><span class="n">remove_reference_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;::</span><span class="n">type</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">monostate</span> <span class="p">{};</span>

<span class="c1">// An enable_if helper to be used in template parameters which results in much</span>
<span class="c1">// shorter symbols: https://godbolt.org/z/sWw4vP. Extra parentheses are needed</span>
<span class="c1">// to workaround a bug in MSVC 2019 (see #1140 and #1186).</span>
<span class="cp">#define FMT_ENABLE_IF(...) enable_if_t&lt;(__VA_ARGS__), int&gt; = 0</span>

<span class="k">namespace</span> <span class="n">internal</span> <span class="p">{</span>

<span class="c1">// A workaround for gcc 4.8 to make void_t work in a SFINAE context.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Ts</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="n">void_t_impl</span> <span class="p">{</span> <span class="k">using</span> <span class="n">type</span> <span class="o">=</span> <span class="kt">void</span><span class="p">;</span> <span class="p">};</span>

<span class="n">FMT_API</span> <span class="kt">void</span> <span class="nf">assert_fail</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message</span><span class="p">);</span>

<span class="cp">#ifndef FMT_ASSERT</span>
<span class="cp">#ifdef NDEBUG</span>
<span class="cp">#define FMT_ASSERT(condition, message)</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_ASSERT(condition, message)                                         \</span>
<span class="cp">  ((condition) ? void()                                                        \</span>
<span class="cp">               : fmt::internal::assert_fail(__FILE__, __LINE__, (message)))</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(FMT_USE_STRING_VIEW)</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span> <span class="k">using</span> <span class="n">std_string_view</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span><span class="p">;</span>
<span class="cp">#elif defined(FMT_USE_EXPERIMENTAL_STRING_VIEW)</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">std_string_view</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">experimental</span><span class="o">::</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span><span class="p">;</span>
<span class="cp">#else</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="n">std_string_view</span> <span class="p">{};</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef FMT_USE_INT128</span>
<span class="c1">// Do nothing.</span>
<span class="cp">#elif defined(__SIZEOF_INT128__)</span>
<span class="cp">#define FMT_USE_INT128 1</span>
<span class="k">using</span> <span class="n">int128_t</span> <span class="o">=</span> <span class="n">__int128_t</span><span class="p">;</span>
<span class="k">using</span> <span class="n">uint128_t</span> <span class="o">=</span> <span class="n">__uint128_t</span><span class="p">;</span>
<span class="cp">#else</span>
<span class="cp">#define FMT_USE_INT128 0</span>
<span class="cp">#endif</span>
<span class="cp">#if !FMT_USE_INT128</span>
<span class="k">struct</span> <span class="n">int128_t</span> <span class="p">{};</span>
<span class="k">struct</span> <span class="n">uint128_t</span> <span class="p">{};</span>
<span class="cp">#endif</span>

<span class="c1">// Casts a nonnegative integer to unsigned.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Int</span><span class="o">&gt;</span>
<span class="n">FMT_CONSTEXPR</span> <span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unsigned</span><span class="o">&lt;</span><span class="n">Int</span><span class="o">&gt;::</span><span class="n">type</span> <span class="n">to_unsigned</span><span class="p">(</span><span class="n">Int</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">FMT_ASSERT</span><span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;negative value&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unsigned</span><span class="o">&lt;</span><span class="n">Int</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span> <span class="c1">// namespace internal</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Ts</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">void_t</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">internal</span><span class="o">::</span><span class="n">void_t_impl</span><span class="o">&lt;</span><span class="n">Ts</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">basic_string_view</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">const</span> <span class="n">Char</span> <span class="o">*</span><span class="n">data_</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">size_</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">char_type</span> <span class="o">=</span> <span class="n">Char</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">iterator</span> <span class="o">=</span> <span class="k">const</span> <span class="n">Char</span> <span class="o">*</span><span class="p">;</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="nf">basic_string_view</span><span class="p">()</span> <span class="nl">FMT_NOEXCEPT</span> <span class="p">:</span> <span class="n">data_</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">size_</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="nf">basic_string_view</span><span class="p">(</span><span class="k">const</span> <span class="n">Char</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span> <span class="nl">FMT_NOEXCEPT</span>
      <span class="p">:</span> <span class="n">data_</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
        <span class="n">size_</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="p">{}</span>

  <span class="n">basic_string_view</span><span class="p">(</span><span class="k">const</span> <span class="n">Char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">data_</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">size_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;::</span><span class="n">length</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="p">{}</span>

  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Traits</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Alloc</span><span class="o">&gt;</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="n">basic_string_view</span><span class="p">(</span>
      <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="n">Char</span><span class="p">,</span> <span class="n">Traits</span><span class="p">,</span> <span class="n">Alloc</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="nl">FMT_NOEXCEPT</span>
      <span class="p">:</span> <span class="n">data_</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span>
        <span class="n">size_</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{}</span>

  <span class="k">template</span> <span class="o">&lt;</span>
      <span class="k">typename</span> <span class="n">S</span><span class="p">,</span>
      <span class="n">FMT_ENABLE_IF</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span> <span class="n">internal</span><span class="o">::</span><span class="n">std_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="n">basic_string_view</span><span class="p">(</span><span class="n">S</span> <span class="n">s</span><span class="p">)</span> <span class="nl">FMT_NOEXCEPT</span> <span class="p">:</span> <span class="n">data_</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span>
                                                      <span class="n">size_</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="p">{}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="k">const</span> <span class="n">Char</span> <span class="o">*</span><span class="n">data</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">data_</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">size_</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="n">iterator</span> <span class="n">begin</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">data_</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="n">iterator</span> <span class="n">end</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">data_</span> <span class="o">+</span> <span class="n">size_</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="k">const</span> <span class="n">Char</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">pos</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">data_</span><span class="p">[</span><span class="n">pos</span><span class="p">];</span> <span class="p">}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="kt">void</span> <span class="n">remove_prefix</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">data_</span> <span class="o">+=</span> <span class="n">n</span><span class="p">;</span>
    <span class="n">size_</span> <span class="o">-=</span> <span class="n">n</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Lexicographically compare this string reference to other.</span>
  <span class="kt">int</span> <span class="n">compare</span><span class="p">(</span><span class="n">basic_string_view</span> <span class="n">other</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="kt">size_t</span> <span class="n">str_size</span> <span class="o">=</span> <span class="n">size_</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">size_</span> <span class="o">?</span> <span class="nl">size_</span> <span class="p">:</span> <span class="n">other</span><span class="p">.</span><span class="n">size_</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">char_traits</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;::</span><span class="n">compare</span><span class="p">(</span><span class="n">data_</span><span class="p">,</span> <span class="n">other</span><span class="p">.</span><span class="n">data_</span><span class="p">,</span> <span class="n">str_size</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">result</span> <span class="o">=</span> <span class="n">size_</span> <span class="o">==</span> <span class="n">other</span><span class="p">.</span><span class="n">size_</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="p">(</span><span class="n">size_</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">.</span><span class="n">size_</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="n">basic_string_view</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">basic_string_view</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="n">basic_string_view</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">basic_string_view</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="n">basic_string_view</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">basic_string_view</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">basic_string_view</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">basic_string_view</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&gt;</span><span class="p">(</span><span class="n">basic_string_view</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">basic_string_view</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&gt;=</span><span class="p">(</span><span class="n">basic_string_view</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">basic_string_view</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">lhs</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="k">using</span> <span class="n">string_view</span> <span class="o">=</span> <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">wstring_view</span> <span class="o">=</span> <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="o">&gt;</span><span class="p">;</span>

<span class="cp">#ifndef __cpp_char8_t</span>
<span class="c1">// A UTF-8 code unit type.</span>
<span class="k">enum</span> <span class="kt">char8_t</span> <span class="o">:</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="p">{};</span>
<span class="cp">#endif</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="nl">is_char</span> <span class="p">:</span> <span class="n">std</span><span class="o">::</span><span class="n">false_type</span> <span class="p">{};</span>
<span class="k">template</span> <span class="o">&lt;&gt;</span> <span class="k">struct</span> <span class="n">is_char</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">true_type</span> <span class="p">{};</span>
<span class="k">template</span> <span class="o">&lt;&gt;</span> <span class="k">struct</span> <span class="n">is_char</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="o">&gt;</span> <span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">true_type</span> <span class="p">{};</span>
<span class="k">template</span> <span class="o">&lt;&gt;</span> <span class="k">struct</span> <span class="n">is_char</span><span class="o">&lt;</span><span class="kt">char8_t</span><span class="o">&gt;</span> <span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">true_type</span> <span class="p">{};</span>
<span class="k">template</span> <span class="o">&lt;&gt;</span> <span class="k">struct</span> <span class="n">is_char</span><span class="o">&lt;</span><span class="kt">char16_t</span><span class="o">&gt;</span> <span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">true_type</span> <span class="p">{};</span>
<span class="k">template</span> <span class="o">&lt;&gt;</span> <span class="k">struct</span> <span class="n">is_char</span><span class="o">&lt;</span><span class="kt">char32_t</span><span class="o">&gt;</span> <span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">true_type</span> <span class="p">{};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="p">,</span> <span class="n">FMT_ENABLE_IF</span><span class="p">(</span><span class="n">is_char</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="n">to_string_view</span><span class="p">(</span><span class="k">const</span> <span class="n">Char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Traits</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Alloc</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span>
<span class="n">to_string_view</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="n">Char</span><span class="p">,</span> <span class="n">Traits</span><span class="p">,</span> <span class="n">Alloc</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="n">to_string_view</span><span class="p">(</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="p">,</span>
          <span class="n">FMT_ENABLE_IF</span><span class="p">(</span><span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">is_empty</span><span class="o">&lt;</span><span class="n">internal</span><span class="o">::</span><span class="n">std_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span>
<span class="n">to_string_view</span><span class="p">(</span><span class="n">internal</span><span class="o">::</span><span class="n">std_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// A base class for compile-time strings. It is defined in the fmt namespace to</span>
<span class="c1">// make formatting functions visible via ADL, e.g. format(fmt(&quot;{}&quot;), 42).</span>
<span class="k">struct</span> <span class="n">compile_string</span> <span class="p">{};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="nl">is_compile_string</span> <span class="p">:</span> <span class="n">std</span><span class="o">::</span><span class="n">is_base_of</span><span class="o">&lt;</span><span class="n">compile_string</span><span class="p">,</span> <span class="n">S</span><span class="o">&gt;</span> <span class="p">{};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="p">,</span> <span class="n">FMT_ENABLE_IF</span><span class="p">(</span><span class="n">is_compile_string</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
<span class="k">constexpr</span> <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="o">::</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="n">to_string_view</span><span class="p">(</span><span class="k">const</span> <span class="n">S</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="n">internal</span> <span class="p">{</span>
<span class="kt">void</span> <span class="n">to_string_view</span><span class="p">(...);</span>
<span class="k">using</span> <span class="n">fmt</span><span class="o">::</span><span class="n">v6</span><span class="o">::</span><span class="n">to_string_view</span><span class="p">;</span>

<span class="c1">// Specifies whether S is a string type convertible to fmt::basic_string_view.</span>
<span class="c1">// It should be a constexpr function but MSVC 2017 fails to compile it in</span>
<span class="c1">// enable_if and MSVC 2015 fails to compile it as an alias template.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="nl">is_string</span> <span class="p">:</span> <span class="n">std</span><span class="o">::</span><span class="n">is_class</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">to_string_view</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">declval</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">()))</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="p">,</span> <span class="k">typename</span> <span class="o">=</span> <span class="kt">void</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="n">char_t_impl</span> <span class="p">{};</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="n">char_t_impl</span><span class="o">&lt;</span><span class="n">S</span><span class="p">,</span> <span class="n">enable_if_t</span><span class="o">&lt;</span><span class="n">is_string</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
  <span class="k">using</span> <span class="n">result</span> <span class="o">=</span> <span class="k">decltype</span><span class="p">(</span><span class="n">to_string_view</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">declval</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">()));</span>
  <span class="k">using</span> <span class="n">type</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">result</span><span class="o">::</span><span class="n">char_type</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">error_handler</span> <span class="p">{</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="n">error_handler</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="nf">error_handler</span><span class="p">(</span><span class="k">const</span> <span class="n">error_handler</span> <span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

  <span class="c1">// This function is intentionally not constexpr to give a compile-time error.</span>
  <span class="n">FMT_NORETURN</span> <span class="n">FMT_API</span> <span class="kt">void</span> <span class="nf">on_error</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message</span><span class="p">);</span>
<span class="p">};</span>
<span class="p">}</span> <span class="c1">// namespace internal</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="o">&gt;</span> <span class="k">using</span> <span class="n">char_t</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">internal</span><span class="o">::</span><span class="n">char_t_impl</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="p">,</span> <span class="k">typename</span> <span class="n">ErrorHandler</span> <span class="o">=</span> <span class="n">internal</span><span class="o">::</span><span class="n">error_handler</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">basic_format_parse_context</span> <span class="o">:</span> <span class="k">private</span> <span class="n">ErrorHandler</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="n">format_str_</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">next_arg_id_</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">char_type</span> <span class="o">=</span> <span class="n">Char</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">iterator</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;::</span><span class="n">iterator</span><span class="p">;</span>

  <span class="k">explicit</span> <span class="n">FMT_CONSTEXPR</span>
  <span class="nf">basic_format_parse_context</span><span class="p">(</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="n">format_str</span><span class="p">,</span>
                             <span class="n">ErrorHandler</span> <span class="n">eh</span> <span class="o">=</span> <span class="n">ErrorHandler</span><span class="p">())</span>
      <span class="o">:</span> <span class="n">ErrorHandler</span><span class="p">(</span><span class="n">eh</span><span class="p">),</span> <span class="n">format_str_</span><span class="p">(</span><span class="n">format_str</span><span class="p">),</span> <span class="n">next_arg_id_</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="n">iterator</span> <span class="nf">begin</span><span class="p">()</span> <span class="k">const</span> <span class="n">FMT_NOEXCEPT</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">format_str_</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="n">iterator</span> <span class="nf">end</span><span class="p">()</span> <span class="k">const</span> <span class="n">FMT_NOEXCEPT</span> <span class="p">{</span> <span class="k">return</span> <span class="n">format_str_</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="p">}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="kt">void</span> <span class="nf">advance_to</span><span class="p">(</span><span class="n">iterator</span> <span class="n">it</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">format_str_</span><span class="p">.</span><span class="n">remove_prefix</span><span class="p">(</span><span class="n">internal</span><span class="o">::</span><span class="n">to_unsigned</span><span class="p">(</span><span class="n">it</span> <span class="o">-</span> <span class="n">begin</span><span class="p">()));</span>
  <span class="p">}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="kt">int</span> <span class="nf">next_arg_id</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">next_arg_id_</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">next_arg_id_</span><span class="o">++</span><span class="p">;</span>
    <span class="n">on_error</span><span class="p">(</span><span class="s">&quot;cannot switch from manual to automatic argument indexing&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="kt">void</span> <span class="nf">check_arg_id</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">next_arg_id_</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">on_error</span><span class="p">(</span><span class="s">&quot;cannot switch from automatic to manual argument indexing&quot;</span><span class="p">);</span>
    <span class="k">else</span>
      <span class="n">next_arg_id_</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="kt">void</span> <span class="nf">check_arg_id</span><span class="p">(</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="kt">void</span> <span class="nf">on_error</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ErrorHandler</span><span class="o">::</span><span class="n">on_error</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="n">ErrorHandler</span> <span class="nf">error_handler</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">using</span> <span class="n">format_parse_context</span> <span class="o">=</span> <span class="n">basic_format_parse_context</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">wformat_parse_context</span> <span class="o">=</span> <span class="n">basic_format_parse_context</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="p">,</span> <span class="k">typename</span> <span class="n">ErrorHandler</span> <span class="o">=</span> <span class="n">internal</span><span class="o">::</span><span class="n">error_handler</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">basic_parse_context</span> <span class="n">FMT_DEPRECATED_ALIAS</span> <span class="o">=</span>
    <span class="n">basic_format_parse_context</span><span class="o">&lt;</span><span class="n">Char</span><span class="p">,</span> <span class="n">ErrorHandler</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">parse_context</span> <span class="n">FMT_DEPRECATED_ALIAS</span> <span class="o">=</span> <span class="n">basic_format_parse_context</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">wparse_context</span> <span class="n">FMT_DEPRECATED_ALIAS</span> <span class="o">=</span> <span class="n">basic_format_parse_context</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">basic_format_arg</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">basic_format_args</span><span class="p">;</span>

<span class="c1">// A formatter for objects of type T.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Char</span> <span class="o">=</span> <span class="kt">char</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Enable</span> <span class="o">=</span> <span class="kt">void</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">formatter</span> <span class="p">{</span>
  <span class="c1">// A deleted default constructor indicates a disabled formatter.</span>
  <span class="n">formatter</span><span class="p">()</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Char</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Enable</span> <span class="o">=</span> <span class="kt">void</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">FMT_DEPRECATED</span> <span class="nl">convert_to_int</span>
    <span class="p">:</span> <span class="n">bool_constant</span><span class="o">&lt;!</span><span class="n">std</span><span class="o">::</span><span class="n">is_arithmetic</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&amp;&amp;</span>
                    <span class="n">std</span><span class="o">::</span><span class="n">is_convertible</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;</span> <span class="p">{};</span>

<span class="c1">// Specifies if T has an enabled formatter specialization. A type can be</span>
<span class="c1">// formattable even if it doesn&#39;t have a formatter e.g. via a conversion.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">has_formatter</span> <span class="o">=</span>
    <span class="n">std</span><span class="o">::</span><span class="n">is_constructible</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">::</span><span class="k">template</span> <span class="n">formatter_type</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">namespace</span> <span class="n">internal</span> <span class="p">{</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">buffer</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">T</span> <span class="o">*</span><span class="n">ptr_</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">size_</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">capacity_</span><span class="p">;</span>

<span class="k">protected</span><span class="o">:</span>
  <span class="c1">// Don&#39;t initialize ptr_ since it is not accessed to save a few cycles.</span>
  <span class="n">buffer</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">sz</span><span class="p">)</span> <span class="nl">FMT_NOEXCEPT</span> <span class="p">:</span> <span class="n">size_</span><span class="p">(</span><span class="n">sz</span><span class="p">),</span> <span class="n">capacity_</span><span class="p">(</span><span class="n">sz</span><span class="p">)</span> <span class="p">{}</span>

  <span class="n">buffer</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">sz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="nl">FMT_NOEXCEPT</span>
      <span class="p">:</span> <span class="n">ptr_</span><span class="p">(</span><span class="n">p</span><span class="p">),</span>
        <span class="n">size_</span><span class="p">(</span><span class="n">sz</span><span class="p">),</span>
        <span class="n">capacity_</span><span class="p">(</span><span class="n">cap</span><span class="p">)</span> <span class="p">{}</span>

  <span class="kt">void</span> <span class="n">set</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">buf_data</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">buf_capacity</span><span class="p">)</span> <span class="n">FMT_NOEXCEPT</span> <span class="p">{</span>
    <span class="n">ptr_</span> <span class="o">=</span> <span class="n">buf_data</span><span class="p">;</span>
    <span class="n">capacity_</span> <span class="o">=</span> <span class="n">buf_capacity</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">grow</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">capacity</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">value_type</span> <span class="o">=</span> <span class="n">T</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">const_reference</span> <span class="o">=</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="p">;</span>

  <span class="n">buffer</span><span class="p">(</span><span class="k">const</span> <span class="n">buffer</span> <span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
  <span class="kt">void</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">buffer</span> <span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">buffer</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>

  <span class="n">T</span> <span class="o">*</span><span class="nf">begin</span><span class="p">()</span> <span class="n">FMT_NOEXCEPT</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ptr_</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">T</span> <span class="o">*</span><span class="nf">end</span><span class="p">()</span> <span class="n">FMT_NOEXCEPT</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ptr_</span> <span class="o">+</span> <span class="n">size_</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">()</span> <span class="k">const</span> <span class="n">FMT_NOEXCEPT</span> <span class="p">{</span> <span class="k">return</span> <span class="n">size_</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">capacity</span><span class="p">()</span> <span class="k">const</span> <span class="n">FMT_NOEXCEPT</span> <span class="p">{</span> <span class="k">return</span> <span class="n">capacity_</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">T</span> <span class="o">*</span><span class="n">data</span><span class="p">()</span> <span class="n">FMT_NOEXCEPT</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ptr_</span><span class="p">;</span> <span class="p">}</span>

  <span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">data</span><span class="p">()</span> <span class="k">const</span> <span class="n">FMT_NOEXCEPT</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ptr_</span><span class="p">;</span> <span class="p">}</span>

  <span class="kt">void</span> <span class="n">resize</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">new_size</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">reserve</span><span class="p">(</span><span class="n">new_size</span><span class="p">);</span>
    <span class="n">size_</span> <span class="o">=</span> <span class="n">new_size</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">clear</span><span class="p">()</span> <span class="p">{</span> <span class="n">size_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>

  <span class="kt">void</span> <span class="n">reserve</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">new_capacity</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">new_capacity</span> <span class="o">&gt;</span> <span class="n">capacity_</span><span class="p">)</span>
      <span class="n">grow</span><span class="p">(</span><span class="n">new_capacity</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="n">push_back</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">reserve</span><span class="p">(</span><span class="n">size_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">ptr_</span><span class="p">[</span><span class="n">size_</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">U</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">append</span><span class="p">(</span><span class="k">const</span> <span class="n">U</span> <span class="o">*</span><span class="n">begin</span><span class="p">,</span> <span class="k">const</span> <span class="n">U</span> <span class="o">*</span><span class="n">end</span><span class="p">);</span>

  <span class="n">T</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ptr_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span> <span class="p">}</span>
  <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">index</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">ptr_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span> <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// A container-backed buffer.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Container</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">container_buffer</span> <span class="o">:</span> <span class="k">public</span> <span class="n">buffer</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Container</span><span class="o">::</span><span class="n">value_type</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">Container</span> <span class="o">&amp;</span><span class="n">container_</span><span class="p">;</span>

<span class="k">protected</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">grow</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">capacity</span><span class="p">)</span> <span class="n">FMT_OVERRIDE</span> <span class="p">{</span>
    <span class="n">container_</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">capacity</span><span class="p">);</span>
    <span class="k">this</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">container_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">capacity</span><span class="p">);</span>
  <span class="p">}</span>

<span class="k">public</span><span class="o">:</span>
  <span class="k">explicit</span> <span class="n">container_buffer</span><span class="p">(</span><span class="n">Container</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">buffer</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Container</span><span class="o">::</span><span class="n">value_type</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">size</span><span class="p">()),</span> <span class="n">container_</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="c1">// Extracts a reference to the container from back_insert_iterator.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Container</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="n">Container</span> <span class="o">&amp;</span><span class="n">get_container</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">back_insert_iterator</span><span class="o">&lt;</span><span class="n">Container</span><span class="o">&gt;</span> <span class="n">it</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">using</span> <span class="n">bi_iterator</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">back_insert_iterator</span><span class="o">&lt;</span><span class="n">Container</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="k">struct</span> <span class="nl">accessor</span> <span class="p">:</span> <span class="n">bi_iterator</span> <span class="p">{</span>
    <span class="n">accessor</span><span class="p">(</span><span class="n">bi_iterator</span> <span class="n">iter</span><span class="p">)</span> <span class="o">:</span> <span class="n">bi_iterator</span><span class="p">(</span><span class="n">iter</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">using</span> <span class="n">bi_iterator</span><span class="o">::</span><span class="n">container</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="o">*</span><span class="nf">accessor</span><span class="p">(</span><span class="n">it</span><span class="p">).</span><span class="n">container</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Char</span> <span class="o">=</span> <span class="kt">char</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Enable</span> <span class="o">=</span> <span class="kt">void</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">fallback_formatter</span> <span class="p">{</span>
  <span class="n">fallback_formatter</span><span class="p">()</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Specifies if T has an enabled fallback_formatter specialization.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">has_fallback_formatter</span> <span class="o">=</span>
    <span class="n">std</span><span class="o">::</span><span class="n">is_constructible</span><span class="o">&lt;</span><span class="n">fallback_formatter</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Context</span><span class="o">::</span><span class="n">char_type</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="n">named_arg_base</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="n">named_arg</span><span class="p">;</span>

<span class="k">enum</span> <span class="n">type</span> <span class="p">{</span>
  <span class="n">none_type</span><span class="p">,</span>
  <span class="n">named_arg_type</span><span class="p">,</span>
  <span class="c1">// Integer types should go first,</span>
  <span class="n">int_type</span><span class="p">,</span>
  <span class="n">uint_type</span><span class="p">,</span>
  <span class="n">long_long_type</span><span class="p">,</span>
  <span class="n">ulong_long_type</span><span class="p">,</span>
  <span class="n">int128_type</span><span class="p">,</span>
  <span class="n">uint128_type</span><span class="p">,</span>
  <span class="n">bool_type</span><span class="p">,</span>
  <span class="n">char_type</span><span class="p">,</span>
  <span class="n">last_integer_type</span> <span class="o">=</span> <span class="n">char_type</span><span class="p">,</span>
  <span class="c1">// followed by floating-point types.</span>
  <span class="n">float_type</span><span class="p">,</span>
  <span class="n">double_type</span><span class="p">,</span>
  <span class="n">long_double_type</span><span class="p">,</span>
  <span class="n">last_numeric_type</span> <span class="o">=</span> <span class="n">long_double_type</span><span class="p">,</span>
  <span class="n">cstring_type</span><span class="p">,</span>
  <span class="n">string_type</span><span class="p">,</span>
  <span class="n">pointer_type</span><span class="p">,</span>
  <span class="n">custom_type</span>
<span class="p">};</span>

<span class="c1">// Maps core type T to the corresponding type enum constant.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="nl">type_constant</span> <span class="p">:</span> <span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="n">type</span><span class="p">,</span> <span class="n">custom_type</span><span class="o">&gt;</span> <span class="p">{};</span>

<span class="cp">#define FMT_TYPE_CONSTANT(Type, constant)                                      \</span>
<span class="cp">  template &lt;typename Char&gt;                                                     \</span>
<span class="cp">  struct type_constant&lt;Type, Char&gt; : std::integral_constant&lt;type, constant&gt; {}</span>

<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="k">const</span> <span class="n">named_arg_base</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">named_arg_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">int_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="kt">unsigned</span><span class="p">,</span> <span class="n">uint_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">,</span> <span class="n">long_long_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">,</span> <span class="n">ulong_long_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="n">int128_t</span><span class="p">,</span> <span class="n">int128_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="n">uint128_t</span><span class="p">,</span> <span class="n">uint128_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="n">bool_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="n">Char</span><span class="p">,</span> <span class="n">char_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="kt">float</span><span class="p">,</span> <span class="n">float_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="kt">double</span><span class="p">,</span> <span class="n">double_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="kt">long</span> <span class="kt">double</span><span class="p">,</span> <span class="n">long_double_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="k">const</span> <span class="n">Char</span> <span class="o">*</span><span class="p">,</span> <span class="n">cstring_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">string_type</span><span class="p">);</span>
<span class="n">FMT_TYPE_CONSTANT</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="n">pointer_type</span><span class="p">);</span>

<span class="n">FMT_CONSTEXPR</span> <span class="kt">bool</span> <span class="nf">is_integral_type</span><span class="p">(</span><span class="n">type</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">FMT_ASSERT</span><span class="p">(</span><span class="n">t</span> <span class="o">!=</span> <span class="n">named_arg_type</span><span class="p">,</span> <span class="s">&quot;invalid argument type&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">none_type</span> <span class="o">&amp;&amp;</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">last_integer_type</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">FMT_CONSTEXPR</span> <span class="kt">bool</span> <span class="nf">is_arithmetic_type</span><span class="p">(</span><span class="n">type</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">FMT_ASSERT</span><span class="p">(</span><span class="n">t</span> <span class="o">!=</span> <span class="n">named_arg_type</span><span class="p">,</span> <span class="s">&quot;invalid argument type&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">none_type</span> <span class="o">&amp;&amp;</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">last_numeric_type</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="n">string_value</span> <span class="p">{</span>
  <span class="k">const</span> <span class="n">Char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="n">custom_value</span> <span class="p">{</span>
  <span class="k">using</span> <span class="n">parse_context</span> <span class="o">=</span> <span class="n">basic_format_parse_context</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">::</span><span class="n">char_type</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>
  <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">format</span><span class="p">)(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="n">parse_context</span> <span class="o">&amp;</span><span class="n">parse_ctx</span><span class="p">,</span> <span class="n">Context</span> <span class="o">&amp;</span><span class="n">ctx</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// A formatting argument value.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">value</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">char_type</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">Context</span><span class="o">::</span><span class="n">char_type</span><span class="p">;</span>

  <span class="k">union</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">int_value</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="n">uint_value</span><span class="p">;</span>
    <span class="kt">long</span> <span class="kt">long</span> <span class="n">long_long_value</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ulong_long_value</span><span class="p">;</span>
    <span class="n">int128_t</span> <span class="n">int128_value</span><span class="p">;</span>
    <span class="n">uint128_t</span> <span class="n">uint128_value</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">bool_value</span><span class="p">;</span>
    <span class="n">char_type</span> <span class="n">char_value</span><span class="p">;</span>
    <span class="kt">float</span> <span class="n">float_value</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">double_value</span><span class="p">;</span>
    <span class="kt">long</span> <span class="kt">double</span> <span class="n">long_double_value</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">pointer</span><span class="p">;</span>
    <span class="n">string_value</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="n">string</span><span class="p">;</span>
    <span class="n">custom_value</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">custom</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">named_arg_base</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">named_arg</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="nf">value</span><span class="p">(</span><span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">int_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="nf">value</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">val</span><span class="p">)</span> <span class="o">:</span> <span class="n">uint_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">value</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">val</span><span class="p">)</span> <span class="o">:</span> <span class="n">long_long_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">value</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">val</span><span class="p">)</span> <span class="o">:</span> <span class="n">ulong_long_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">value</span><span class="p">(</span><span class="n">int128_t</span> <span class="n">val</span><span class="p">)</span> <span class="o">:</span> <span class="n">int128_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">value</span><span class="p">(</span><span class="n">uint128_t</span> <span class="n">val</span><span class="p">)</span> <span class="o">:</span> <span class="n">uint128_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">value</span><span class="p">(</span><span class="kt">float</span> <span class="n">val</span><span class="p">)</span> <span class="o">:</span> <span class="n">float_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">value</span><span class="p">(</span><span class="kt">double</span> <span class="n">val</span><span class="p">)</span> <span class="o">:</span> <span class="n">double_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">value</span><span class="p">(</span><span class="kt">long</span> <span class="kt">double</span> <span class="n">val</span><span class="p">)</span> <span class="o">:</span> <span class="n">long_double_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">value</span><span class="p">(</span><span class="kt">bool</span> <span class="n">val</span><span class="p">)</span> <span class="o">:</span> <span class="n">bool_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">value</span><span class="p">(</span><span class="n">char_type</span> <span class="n">val</span><span class="p">)</span> <span class="o">:</span> <span class="n">char_value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">value</span><span class="p">(</span><span class="k">const</span> <span class="n">char_type</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="n">string</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">value</span><span class="p">(</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">string</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">val</span><span class="p">.</span><span class="n">data</span><span class="p">();</span>
    <span class="n">string</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">val</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">value</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span> <span class="o">:</span> <span class="n">pointer</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{}</span>

  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">value</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">custom</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">;</span>
    <span class="c1">// Get the formatter type through the context to allow different contexts</span>
    <span class="c1">// have different extension points, e.g. `formatter&lt;T&gt;` for `format` and</span>
    <span class="c1">// `printf_formatter&lt;T&gt;` for `printf`.</span>
    <span class="n">custom</span><span class="p">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">format_custom_arg</span><span class="o">&lt;</span>
        <span class="n">T</span><span class="p">,</span> <span class="n">conditional_t</span><span class="o">&lt;</span><span class="n">has_formatter</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Context</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span>
                         <span class="k">typename</span> <span class="n">Context</span><span class="o">::</span><span class="k">template</span> <span class="n">formatter_type</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span>
                         <span class="n">fallback_formatter</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">char_type</span><span class="o">&gt;&gt;&gt;</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">value</span><span class="p">(</span><span class="k">const</span> <span class="n">named_arg_base</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="n">named_arg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">;</span> <span class="p">}</span>

<span class="k">private</span><span class="o">:</span>
  <span class="c1">// Formats an argument of a custom type, such as a user-defined class.</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Formatter</span><span class="o">&gt;</span>
  <span class="k">static</span> <span class="kt">void</span>
  <span class="n">format_custom_arg</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span>
                    <span class="n">basic_format_parse_context</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">parse_ctx</span><span class="p">,</span>
                    <span class="n">Context</span> <span class="o">&amp;</span><span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Formatter</span> <span class="n">f</span><span class="p">;</span>
    <span class="n">parse_ctx</span><span class="p">.</span><span class="n">advance_to</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">parse_ctx</span><span class="p">));</span>
    <span class="n">ctx</span><span class="p">.</span><span class="n">advance_to</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">T</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span> <span class="n">ctx</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">FMT_CONSTEXPR</span> <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">make_arg</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>

<span class="c1">// To minimize the number of types we need to deal with, long is translated</span>
<span class="c1">// either to int or to long long depending on its size.</span>
<span class="k">enum</span> <span class="p">{</span> <span class="n">long_short</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">long</span><span class="p">)</span> <span class="o">==</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">};</span>
<span class="k">using</span> <span class="n">long_type</span> <span class="o">=</span> <span class="n">conditional_t</span><span class="o">&lt;</span><span class="n">long_short</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">long</span> <span class="kt">long</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">ulong_type</span> <span class="o">=</span> <span class="n">conditional_t</span><span class="o">&lt;</span><span class="n">long_short</span><span class="p">,</span> <span class="kt">unsigned</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="o">&gt;</span><span class="p">;</span>

<span class="c1">// Maps formatting arguments to core types.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="n">arg_mapper</span> <span class="p">{</span>
  <span class="k">using</span> <span class="n">char_type</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">Context</span><span class="o">::</span><span class="n">char_type</span><span class="p">;</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="kt">int</span> <span class="nf">map</span><span class="p">(</span><span class="kt">signed</span> <span class="kt">char</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="kt">unsigned</span> <span class="nf">map</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="kt">int</span> <span class="nf">map</span><span class="p">(</span><span class="kt">short</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="kt">unsigned</span> <span class="nf">map</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="kt">int</span> <span class="nf">map</span><span class="p">(</span><span class="kt">int</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="kt">unsigned</span> <span class="nf">map</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="n">long_type</span> <span class="nf">map</span><span class="p">(</span><span class="kt">long</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="n">ulong_type</span> <span class="nf">map</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="kt">long</span> <span class="kt">long</span> <span class="nf">map</span><span class="p">(</span><span class="kt">long</span> <span class="kt">long</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="nf">map</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="n">int128_t</span> <span class="nf">map</span><span class="p">(</span><span class="n">int128_t</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="n">uint128_t</span> <span class="nf">map</span><span class="p">(</span><span class="n">uint128_t</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="kt">bool</span> <span class="nf">map</span><span class="p">(</span><span class="kt">bool</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>

  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="n">FMT_ENABLE_IF</span><span class="p">(</span><span class="n">is_char</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="n">char_type</span> <span class="n">map</span><span class="p">(</span><span class="n">T</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">char</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">||</span>
                      <span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">char_type</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span>
                  <span class="s">&quot;mixing character types is disallowed&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="kt">float</span> <span class="n">map</span><span class="p">(</span><span class="kt">float</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="kt">double</span> <span class="n">map</span><span class="p">(</span><span class="kt">double</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="kt">long</span> <span class="kt">double</span> <span class="n">map</span><span class="p">(</span><span class="kt">long</span> <span class="kt">double</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="k">const</span> <span class="n">char_type</span> <span class="o">*</span><span class="n">map</span><span class="p">(</span><span class="n">char_type</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="k">const</span> <span class="n">char_type</span> <span class="o">*</span><span class="n">map</span><span class="p">(</span><span class="k">const</span> <span class="n">char_type</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="n">FMT_ENABLE_IF</span><span class="p">(</span><span class="n">is_string</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="n">map</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">char_type</span><span class="p">,</span> <span class="n">char_t</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;::</span><span class="n">value</span><span class="p">,</span>
                  <span class="s">&quot;mixing character types is disallowed&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nf">to_string_view</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span>
            <span class="n">FMT_ENABLE_IF</span><span class="p">(</span>
                <span class="n">std</span><span class="o">::</span><span class="n">is_constructible</span><span class="o">&lt;</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&amp;&amp;</span>
                <span class="o">!</span><span class="n">is_string</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="n">map</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">template</span> <span class="o">&lt;</span>
      <span class="k">typename</span> <span class="n">T</span><span class="p">,</span>
      <span class="n">FMT_ENABLE_IF</span><span class="p">(</span>
          <span class="n">std</span><span class="o">::</span><span class="n">is_constructible</span><span class="o">&lt;</span><span class="n">std_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&amp;&amp;</span>
          <span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">is_constructible</span><span class="o">&lt;</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&amp;&amp;</span>
          <span class="o">!</span><span class="n">is_string</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">has_formatter</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Context</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="n">map</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">std_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">map</span><span class="p">(</span><span class="k">const</span> <span class="kt">signed</span> <span class="kt">char</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">char_type</span><span class="p">,</span> <span class="kt">char</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;invalid string type&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">map</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">char_type</span><span class="p">,</span> <span class="kt">char</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;invalid string type&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">map</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">map</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">map</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">nullptr_t</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">val</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">FMT_CONSTEXPR</span> <span class="kt">int</span> <span class="n">map</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Formatting of arbitrary pointers is disallowed. If you want to output</span>
    <span class="c1">// a pointer cast it to &quot;void *&quot; or &quot;const void *&quot;. In particular, this</span>
    <span class="c1">// forbids formatting of &quot;[const] volatile char *&quot; which is printed as bool</span>
    <span class="c1">// by iostreams.</span>
    <span class="k">static_assert</span><span class="p">(</span><span class="o">!</span><span class="k">sizeof</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="s">&quot;formatting of non-void pointers is disallowed&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span>
            <span class="n">FMT_ENABLE_IF</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_enum</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&amp;&amp;</span>
                          <span class="o">!</span><span class="n">has_formatter</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Context</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&amp;&amp;</span>
                          <span class="o">!</span><span class="n">has_fallback_formatter</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Context</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="k">auto</span> <span class="n">map</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span>
      <span class="n">map</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">underlying_type</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">map</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">std</span><span class="o">::</span><span class="n">underlying_type</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;</span><span class="p">(</span><span class="n">val</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">template</span> <span class="o">&lt;</span>
      <span class="k">typename</span> <span class="n">T</span><span class="p">,</span>
      <span class="n">FMT_ENABLE_IF</span><span class="p">(</span>
          <span class="o">!</span><span class="n">is_string</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">is_char</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&amp;&amp;</span>
          <span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">is_constructible</span><span class="o">&lt;</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&amp;&amp;</span>
          <span class="p">(</span><span class="n">has_formatter</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Context</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">||</span>
           <span class="p">(</span><span class="n">has_fallback_formatter</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Context</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&amp;&amp;</span>
            <span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">is_constructible</span><span class="o">&lt;</span><span class="n">std_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)))</span><span class="o">&gt;</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">map</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
  <span class="n">FMT_CONSTEXPR</span> <span class="k">const</span> <span class="n">named_arg_base</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="o">&amp;</span>
  <span class="n">map</span><span class="p">(</span><span class="k">const</span> <span class="n">named_arg</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">char_type</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">make_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">memcpy</span><span class="p">(</span><span class="n">val</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">arg</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">val</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// A type constant after applying arg_mapper&lt;Context&gt;.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">mapped_type_constant</span> <span class="o">=</span> <span class="n">type_constant</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">arg_mapper</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">().</span><span class="n">map</span><span class="p">(</span>
                                               <span class="n">std</span><span class="o">::</span><span class="n">declval</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;&gt;</span><span class="p">())),</span>
                                           <span class="k">typename</span> <span class="n">Context</span><span class="o">::</span><span class="n">char_type</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">enum</span> <span class="p">{</span> <span class="n">packed_arg_bits</span> <span class="o">=</span> <span class="mi">5</span> <span class="p">};</span>
<span class="c1">// Maximum number of arguments with packed types.</span>
<span class="k">enum</span> <span class="p">{</span> <span class="n">max_packed_args</span> <span class="o">=</span> <span class="mi">63</span> <span class="o">/</span> <span class="n">packed_arg_bits</span> <span class="p">};</span>
<span class="k">enum</span> <span class="o">:</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="p">{</span> <span class="n">is_unpacked_bit</span> <span class="o">=</span> <span class="mi">1ULL</span> <span class="o">&lt;&lt;</span> <span class="mi">63</span> <span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">arg_map</span><span class="p">;</span>
<span class="p">}</span> <span class="c1">// namespace internal</span>

<span class="c1">// A formatting argument. It is a trivially copyable/constructible type to</span>
<span class="c1">// allow storage in basic_memory_buffer.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">basic_format_arg</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">internal</span><span class="o">::</span><span class="n">value</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">value_</span><span class="p">;</span>
  <span class="n">internal</span><span class="o">::</span><span class="n">type</span> <span class="n">type_</span><span class="p">;</span>

  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">ContextType</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
  <span class="k">friend</span> <span class="n">FMT_CONSTEXPR</span> <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">ContextType</span><span class="o">&gt;</span>
  <span class="n">internal</span><span class="o">::</span><span class="n">make_arg</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>

  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Visitor</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Ctx</span><span class="o">&gt;</span>
  <span class="k">friend</span> <span class="n">FMT_CONSTEXPR</span> <span class="k">auto</span> <span class="n">visit_format_arg</span><span class="p">(</span><span class="n">Visitor</span> <span class="o">&amp;&amp;</span><span class="n">vis</span><span class="p">,</span>
                                             <span class="k">const</span> <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Ctx</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">arg</span><span class="p">)</span>
      <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">vis</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

  <span class="k">friend</span> <span class="k">class</span> <span class="nc">basic_format_args</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">internal</span><span class="o">::</span><span class="n">arg_map</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="k">using</span> <span class="n">char_type</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">Context</span><span class="o">::</span><span class="n">char_type</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
  <span class="k">class</span> <span class="nc">handle</span> <span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
    <span class="k">explicit</span> <span class="n">handle</span><span class="p">(</span><span class="n">internal</span><span class="o">::</span><span class="n">custom_value</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">custom</span><span class="p">)</span> <span class="o">:</span> <span class="n">custom_</span><span class="p">(</span><span class="n">custom</span><span class="p">)</span> <span class="p">{}</span>

    <span class="kt">void</span> <span class="n">format</span><span class="p">(</span><span class="n">basic_format_parse_context</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">parse_ctx</span><span class="p">,</span>
                <span class="n">Context</span> <span class="o">&amp;</span><span class="n">ctx</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
      <span class="n">custom_</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="n">custom_</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">parse_ctx</span><span class="p">,</span> <span class="n">ctx</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="k">private</span><span class="o">:</span>
    <span class="n">internal</span><span class="o">::</span><span class="n">custom_value</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">custom_</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="nf">basic_format_arg</span><span class="p">()</span> <span class="o">:</span> <span class="n">type_</span><span class="p">(</span><span class="n">internal</span><span class="o">::</span><span class="n">none_type</span><span class="p">)</span> <span class="p">{}</span>

  <span class="n">FMT_CONSTEXPR</span> <span class="k">explicit</span> <span class="k">operator</span> <span class="nf">bool</span><span class="p">()</span> <span class="k">const</span> <span class="n">FMT_NOEXCEPT</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">type_</span> <span class="o">!=</span> <span class="n">internal</span><span class="o">::</span><span class="n">none_type</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">internal</span><span class="o">::</span><span class="n">type</span> <span class="n">type</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">type_</span><span class="p">;</span> <span class="p">}</span>

  <span class="kt">bool</span> <span class="n">is_integral</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">internal</span><span class="o">::</span><span class="n">is_integral_type</span><span class="p">(</span><span class="n">type_</span><span class="p">);</span> <span class="p">}</span>
  <span class="kt">bool</span> <span class="n">is_arithmetic</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">internal</span><span class="o">::</span><span class="n">is_arithmetic_type</span><span class="p">(</span><span class="n">type_</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Visitor</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span>
<span class="n">FMT_CONSTEXPR</span> <span class="k">auto</span> <span class="n">visit_format_arg</span><span class="p">(</span><span class="n">Visitor</span> <span class="o">&amp;&amp;</span><span class="n">vis</span><span class="p">,</span>
                                    <span class="k">const</span> <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">arg</span><span class="p">)</span>
    <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">vis</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">using</span> <span class="n">char_type</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">Context</span><span class="o">::</span><span class="n">char_type</span><span class="p">;</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">type_</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">none_type</span><span class="p">:</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">named_arg_type</span><span class="p">:</span>
    <span class="n">FMT_ASSERT</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span> <span class="s">&quot;invalid argument type&quot;</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">int_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">int_value</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">uint_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">uint_value</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">long_long_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">long_long_value</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">ulong_long_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">ulong_long_value</span><span class="p">);</span>
<span class="cp">#if FMT_USE_INT128</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">int128_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">int128_value</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">uint128_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">uint128_value</span><span class="p">);</span>
<span class="cp">#else</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">int128_type</span><span class="p">:</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">uint128_type</span><span class="p">:</span>
    <span class="k">break</span><span class="p">;</span>
<span class="cp">#endif</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">bool_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">bool_value</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">char_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">char_value</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">float_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">float_value</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">double_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">double_value</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">long_double_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">long_double_value</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">cstring_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">string_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">data</span><span class="p">,</span>
                                            <span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">size</span><span class="p">));</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">pointer_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">pointer</span><span class="p">);</span>
  <span class="k">case</span> <span class="n">internal</span><span class="o">::</span><span class="nl">custom_type</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="k">typename</span> <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;::</span><span class="n">handle</span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">custom</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">vis</span><span class="p">(</span><span class="n">monostate</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="n">internal</span> <span class="p">{</span>
<span class="c1">// A map from argument names to their values for named arguments.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">arg_map</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">char_type</span> <span class="o">=</span> <span class="k">typename</span> <span class="n">Context</span><span class="o">::</span><span class="n">char_type</span><span class="p">;</span>

  <span class="k">struct</span> <span class="n">entry</span> <span class="p">{</span>
    <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="n">name</span><span class="p">;</span>
    <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">arg</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="n">entry</span> <span class="o">*</span><span class="n">map_</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="n">size_</span><span class="p">;</span>

  <span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="n">value</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="n">named</span> <span class="o">=</span> <span class="o">*</span><span class="n">val</span><span class="p">.</span><span class="n">named_arg</span><span class="p">;</span>
    <span class="n">map_</span><span class="p">[</span><span class="n">size_</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">named</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">named</span><span class="p">.</span><span class="k">template</span> <span class="n">deserialize</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">()};</span>
    <span class="o">++</span><span class="n">size_</span><span class="p">;</span>
  <span class="p">}</span>

<span class="k">public</span><span class="o">:</span>
  <span class="n">arg_map</span><span class="p">(</span><span class="k">const</span> <span class="n">arg_map</span> <span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
  <span class="kt">void</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">arg_map</span> <span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
  <span class="n">arg_map</span><span class="p">()</span> <span class="o">:</span> <span class="n">map_</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">size_</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">void</span> <span class="n">init</span><span class="p">(</span><span class="k">const</span> <span class="n">basic_format_args</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">args</span><span class="p">);</span>
  <span class="o">~</span><span class="n">arg_map</span><span class="p">()</span> <span class="p">{</span> <span class="k">delete</span><span class="p">[]</span> <span class="n">map_</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">find</span><span class="p">(</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="n">name</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="c1">// The list is unsorted, so just return the first matching name.</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">entry</span> <span class="o">*</span><span class="n">it</span> <span class="o">=</span> <span class="n">map_</span><span class="p">,</span> <span class="o">*</span><span class="n">end</span> <span class="o">=</span> <span class="n">map_</span> <span class="o">+</span> <span class="n">size_</span><span class="p">;</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">end</span><span class="p">;</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">it</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">{};</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// A type-erased reference to an std::locale to avoid heavy &lt;locale&gt; include.</span>
<span class="k">class</span> <span class="nc">locale_ref</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">locale_</span><span class="p">;</span> <span class="c1">// A type-erased pointer to std::locale.</span>

<span class="k">public</span><span class="o">:</span>
  <span class="n">locale_ref</span><span class="p">()</span> <span class="o">:</span> <span class="n">locale_</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Locale</span><span class="o">&gt;</span> <span class="k">explicit</span> <span class="n">locale_ref</span><span class="p">(</span><span class="k">const</span> <span class="n">Locale</span> <span class="o">&amp;</span><span class="n">loc</span><span class="p">);</span>

  <span class="k">explicit</span> <span class="k">operator</span> <span class="nf">bool</span><span class="p">()</span> <span class="k">const</span> <span class="n">FMT_NOEXCEPT</span> <span class="p">{</span> <span class="k">return</span> <span class="n">locale_</span> <span class="o">!=</span> <span class="k">nullptr</span><span class="p">;</span> <span class="p">}</span>

  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Locale</span><span class="o">&gt;</span> <span class="n">Locale</span> <span class="n">get</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="o">&gt;</span> <span class="k">constexpr</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">encode_types</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Arg</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
<span class="k">constexpr</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">encode_types</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">mapped_type_constant</span><span class="o">&lt;</span><span class="n">Arg</span><span class="p">,</span> <span class="n">Context</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">|</span>
         <span class="p">(</span><span class="n">encode_types</span><span class="o">&lt;</span><span class="n">Context</span><span class="p">,</span> <span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">packed_arg_bits</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">FMT_CONSTEXPR</span> <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">make_arg</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">arg</span><span class="p">;</span>
  <span class="n">arg</span><span class="p">.</span><span class="n">type_</span> <span class="o">=</span> <span class="n">mapped_type_constant</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Context</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
  <span class="n">arg</span><span class="p">.</span><span class="n">value_</span> <span class="o">=</span> <span class="n">arg_mapper</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">arg</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="kt">bool</span> <span class="n">IS_PACKED</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Context</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span>
          <span class="n">FMT_ENABLE_IF</span><span class="p">(</span><span class="n">IS_PACKED</span><span class="p">)</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="n">value</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">make_arg</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">arg_mapper</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="kt">bool</span> <span class="n">IS_PACKED</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Context</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span>
          <span class="n">FMT_ENABLE_IF</span><span class="p">(</span><span class="o">!</span><span class="n">IS_PACKED</span><span class="p">)</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">make_arg</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">make_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">}</span> <span class="c1">// namespace internal</span>

<span class="c1">// Formatting context.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">OutputIt</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">basic_format_context</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">char_type</span> <span class="o">=</span> <span class="n">Char</span><span class="p">;</span>

<span class="k">private</span><span class="o">:</span>
  <span class="n">OutputIt</span> <span class="n">out_</span><span class="p">;</span>
  <span class="n">basic_format_args</span><span class="o">&lt;</span><span class="n">basic_format_context</span><span class="o">&gt;</span> <span class="n">args_</span><span class="p">;</span>
  <span class="n">internal</span><span class="o">::</span><span class="n">arg_map</span><span class="o">&lt;</span><span class="n">basic_format_context</span><span class="o">&gt;</span> <span class="n">map_</span><span class="p">;</span>
  <span class="n">internal</span><span class="o">::</span><span class="n">locale_ref</span> <span class="n">loc_</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">OutputIt</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">format_arg</span> <span class="o">=</span> <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">basic_format_context</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">using</span> <span class="n">formatter_type</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">char_type</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="n">basic_format_context</span><span class="p">(</span><span class="k">const</span> <span class="n">basic_format_context</span> <span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
  <span class="kt">void</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">basic_format_context</span> <span class="o">&amp;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
  <span class="n">basic_format_context</span><span class="p">(</span><span class="n">OutputIt</span> <span class="n">out</span><span class="p">,</span>
                       <span class="n">basic_format_args</span><span class="o">&lt;</span><span class="n">basic_format_context</span><span class="o">&gt;</span> <span class="n">ctx_args</span><span class="p">,</span>
                       <span class="n">internal</span><span class="o">::</span><span class="n">locale_ref</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">internal</span><span class="o">::</span><span class="n">locale_ref</span><span class="p">())</span>
      <span class="o">:</span> <span class="n">out_</span><span class="p">(</span><span class="n">out</span><span class="p">),</span> <span class="n">args_</span><span class="p">(</span><span class="n">ctx_args</span><span class="p">),</span> <span class="n">loc_</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span> <span class="p">{}</span>

  <span class="n">format_arg</span> <span class="n">arg</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">args_</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">id</span><span class="p">);</span> <span class="p">}</span>

  <span class="c1">// Checks if manual indexing is used and returns the argument with the</span>
  <span class="c1">// specified name.</span>
  <span class="n">format_arg</span> <span class="n">arg</span><span class="p">(</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">char_type</span><span class="o">&gt;</span> <span class="n">name</span><span class="p">);</span>

  <span class="n">internal</span><span class="o">::</span><span class="n">error_handler</span> <span class="n">error_handler</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="p">{};</span> <span class="p">}</span>
  <span class="kt">void</span> <span class="n">on_error</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message</span><span class="p">)</span> <span class="p">{</span> <span class="n">error_handler</span><span class="p">().</span><span class="n">on_error</span><span class="p">(</span><span class="n">message</span><span class="p">);</span> <span class="p">}</span>

  <span class="c1">// Returns an iterator to the beginning of the output range.</span>
  <span class="n">iterator</span> <span class="n">out</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">out_</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">// Advances the begin iterator to ``it``.</span>
  <span class="kt">void</span> <span class="n">advance_to</span><span class="p">(</span><span class="n">iterator</span> <span class="n">it</span><span class="p">)</span> <span class="p">{</span> <span class="n">out_</span> <span class="o">=</span> <span class="n">it</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">internal</span><span class="o">::</span><span class="n">locale_ref</span> <span class="n">locale</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">loc_</span><span class="p">;</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">buffer_context</span> <span class="o">=</span>
    <span class="n">basic_format_context</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">back_insert_iterator</span><span class="o">&lt;</span><span class="n">internal</span><span class="o">::</span><span class="n">buffer</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;&gt;</span><span class="p">,</span>
                         <span class="n">Char</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">format_context</span> <span class="o">=</span> <span class="n">buffer_context</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">;</span>
<span class="k">using</span> <span class="n">wformat_context</span> <span class="o">=</span> <span class="n">buffer_context</span><span class="o">&lt;</span><span class="kt">wchar_t</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">format_arg_store</span> <span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">size_t</span> <span class="n">num_args</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">...(</span><span class="n">Args</span><span class="p">);</span>
  <span class="k">static</span> <span class="k">const</span> <span class="kt">bool</span> <span class="n">is_packed</span> <span class="o">=</span> <span class="n">num_args</span> <span class="o">&lt;</span> <span class="n">internal</span><span class="o">::</span><span class="n">max_packed_args</span><span class="p">;</span>

  <span class="k">using</span> <span class="n">value_type</span> <span class="o">=</span> <span class="n">conditional_t</span><span class="o">&lt;</span><span class="n">is_packed</span><span class="p">,</span> <span class="n">internal</span><span class="o">::</span><span class="n">value</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">,</span>
                                   <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;&gt;</span><span class="p">;</span>

  <span class="c1">// If the arguments are not packed, add one more element to mark the end.</span>
  <span class="n">value_type</span> <span class="n">data_</span><span class="p">[</span><span class="n">num_args</span> <span class="o">+</span> <span class="p">(</span><span class="n">num_args</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)];</span>

  <span class="k">friend</span> <span class="k">class</span> <span class="nc">basic_format_args</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">public</span><span class="o">:</span>
  <span class="k">static</span> <span class="k">constexpr</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">types</span> <span class="o">=</span>
      <span class="n">is_packed</span> <span class="o">?</span> <span class="n">internal</span><span class="o">::</span><span class="n">encode_types</span><span class="o">&lt;</span><span class="n">Context</span><span class="p">,</span> <span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="p">()</span>
                <span class="o">:</span> <span class="n">internal</span><span class="o">::</span><span class="n">is_unpacked_bit</span> <span class="o">|</span> <span class="n">num_args</span><span class="p">;</span>

  <span class="n">format_arg_store</span><span class="p">(</span><span class="k">const</span> <span class="n">Args</span> <span class="o">&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">data_</span><span class="p">{</span><span class="n">internal</span><span class="o">::</span><span class="n">make_arg</span><span class="o">&lt;</span><span class="n">is_packed</span><span class="p">,</span> <span class="n">Context</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)...}</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span> <span class="o">=</span> <span class="n">format_context</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="n">format_arg_store</span><span class="o">&lt;</span><span class="n">Context</span><span class="p">,</span> <span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span>
<span class="n">make_format_args</span><span class="p">(</span><span class="k">const</span> <span class="n">Args</span> <span class="o">&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span><span class="n">args</span><span class="p">...};</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">basic_format_args</span> <span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">size_type</span> <span class="o">=</span> <span class="kt">int</span><span class="p">;</span>
  <span class="k">using</span> <span class="n">format_arg</span> <span class="o">=</span> <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">;</span>

<span class="k">private</span><span class="o">:</span>
  <span class="c1">// To reduce compiled code size per formatting function call, types of first</span>
  <span class="c1">// max_packed_args arguments are passed in the types_ field.</span>
  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">types_</span><span class="p">;</span>
  <span class="k">union</span> <span class="p">{</span>
    <span class="c1">// If the number of arguments is less than max_packed_args, the argument</span>
    <span class="c1">// values are stored in values_, otherwise they are stored in args_.</span>
    <span class="c1">// This is done to reduce compiled code size as storing larger objects</span>
    <span class="c1">// may require more code (at least on x86-64) even if the same amount of</span>
    <span class="c1">// data is actually copied to stack. It saves ~10% on the bloat test.</span>
    <span class="k">const</span> <span class="n">internal</span><span class="o">::</span><span class="n">value</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">values_</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">format_arg</span> <span class="o">*</span><span class="n">args_</span><span class="p">;</span>
  <span class="p">};</span>

  <span class="kt">bool</span> <span class="nf">is_packed</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="p">(</span><span class="n">types_</span> <span class="o">&amp;</span> <span class="n">internal</span><span class="o">::</span><span class="n">is_unpacked_bit</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">internal</span><span class="o">::</span><span class="n">type</span> <span class="n">type</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">shift</span> <span class="o">=</span> <span class="n">index</span> <span class="o">*</span> <span class="n">internal</span><span class="o">::</span><span class="n">packed_arg_bits</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">internal</span><span class="o">::</span><span class="n">packed_arg_bits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">internal</span><span class="o">::</span><span class="n">type</span><span class="o">&gt;</span><span class="p">((</span><span class="n">types_</span> <span class="o">&gt;&gt;</span> <span class="n">shift</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">friend</span> <span class="k">class</span> <span class="nc">internal</span><span class="o">::</span><span class="n">arg_map</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">;</span>

  <span class="kt">void</span> <span class="nf">set_data</span><span class="p">(</span><span class="k">const</span> <span class="n">internal</span><span class="o">::</span><span class="n">value</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">values</span><span class="p">)</span> <span class="p">{</span> <span class="n">values_</span> <span class="o">=</span> <span class="n">values</span><span class="p">;</span> <span class="p">}</span>
  <span class="kt">void</span> <span class="nf">set_data</span><span class="p">(</span><span class="k">const</span> <span class="n">format_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="p">{</span> <span class="n">args_</span> <span class="o">=</span> <span class="n">args</span><span class="p">;</span> <span class="p">}</span>

  <span class="n">format_arg</span> <span class="nf">do_get</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">format_arg</span> <span class="n">arg</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_packed</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">auto</span> <span class="n">num_args</span> <span class="o">=</span> <span class="n">max_size</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">num_args</span><span class="p">)</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">args_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
      <span class="k">return</span> <span class="n">arg</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">internal</span><span class="o">::</span><span class="n">max_packed_args</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">arg</span><span class="p">;</span>
    <span class="n">arg</span><span class="p">.</span><span class="n">type_</span> <span class="o">=</span> <span class="n">type</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">type_</span> <span class="o">==</span> <span class="n">internal</span><span class="o">::</span><span class="n">none_type</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">arg</span><span class="p">;</span>
    <span class="n">internal</span><span class="o">::</span><span class="n">value</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">val</span> <span class="o">=</span> <span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">;</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">values_</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">arg</span><span class="p">;</span>
  <span class="p">}</span>

<span class="k">public</span><span class="o">:</span>
  <span class="n">basic_format_args</span><span class="p">()</span> <span class="o">:</span> <span class="n">types_</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>

  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
  <span class="n">basic_format_args</span><span class="p">(</span><span class="k">const</span> <span class="n">format_arg_store</span><span class="o">&lt;</span><span class="n">Context</span><span class="p">,</span> <span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">store</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">types_</span><span class="p">(</span><span class="n">store</span><span class="p">.</span><span class="n">types</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">set_data</span><span class="p">(</span><span class="n">store</span><span class="p">.</span><span class="n">data_</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">basic_format_args</span><span class="p">(</span><span class="k">const</span> <span class="n">format_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">types_</span><span class="p">(</span><span class="n">internal</span><span class="o">::</span><span class="n">is_unpacked_bit</span> <span class="o">|</span> <span class="n">internal</span><span class="o">::</span><span class="n">to_unsigned</span><span class="p">(</span><span class="n">count</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">set_data</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">format_arg</span> <span class="n">get</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">format_arg</span> <span class="n">arg</span> <span class="o">=</span> <span class="n">do_get</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="n">type_</span> <span class="o">==</span> <span class="n">internal</span><span class="o">::</span><span class="n">named_arg_type</span><span class="p">)</span>
      <span class="n">arg</span> <span class="o">=</span> <span class="n">arg</span><span class="p">.</span><span class="n">value_</span><span class="p">.</span><span class="n">named_arg</span><span class="o">-&gt;</span><span class="k">template</span> <span class="n">deserialize</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">arg</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kt">int</span> <span class="n">max_size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">max_packed</span> <span class="o">=</span> <span class="n">internal</span><span class="o">::</span><span class="n">max_packed_args</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">is_packed</span><span class="p">()</span> <span class="o">?</span> <span class="nl">max_packed</span>
                                        <span class="p">:</span> <span class="n">types_</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">internal</span><span class="o">::</span><span class="n">is_unpacked_bit</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// It is a separate type rather than an alias to make symbols readable.</span>
<span class="k">struct</span> <span class="nl">format_args</span> <span class="p">:</span> <span class="n">basic_format_args</span><span class="o">&lt;</span><span class="n">format_context</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
  <span class="n">format_args</span><span class="p">(</span><span class="n">Args</span> <span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">basic_format_args</span><span class="o">&lt;</span><span class="n">format_context</span><span class="o">&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)...)</span> <span class="p">{}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">wformat_args</span> <span class="p">:</span> <span class="n">basic_format_args</span><span class="o">&lt;</span><span class="n">wformat_context</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
  <span class="n">wformat_args</span><span class="p">(</span><span class="n">Args</span> <span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">basic_format_args</span><span class="o">&lt;</span><span class="n">wformat_context</span><span class="o">&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)...)</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Container</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="nl">is_contiguous</span> <span class="p">:</span> <span class="n">std</span><span class="o">::</span><span class="n">false_type</span> <span class="p">{};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">is_contiguous</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;&gt;</span> <span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">true_type</span> <span class="p">{};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">is_contiguous</span><span class="o">&lt;</span><span class="n">internal</span><span class="o">::</span><span class="n">buffer</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;&gt;</span> <span class="o">:</span> <span class="n">std</span><span class="o">::</span><span class="n">true_type</span> <span class="p">{};</span>

<span class="k">namespace</span> <span class="n">internal</span> <span class="p">{</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">OutputIt</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="nl">is_contiguous_back_insert_iterator</span> <span class="p">:</span> <span class="n">std</span><span class="o">::</span><span class="n">false_type</span> <span class="p">{};</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Container</span><span class="o">&gt;</span>
<span class="k">struct</span> <span class="n">is_contiguous_back_insert_iterator</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">back_insert_iterator</span><span class="o">&lt;</span><span class="n">Container</span><span class="o">&gt;&gt;</span>
    <span class="o">:</span> <span class="n">is_contiguous</span><span class="o">&lt;</span><span class="n">Container</span><span class="o">&gt;</span> <span class="p">{};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="n">named_arg_base</span> <span class="p">{</span>
  <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="n">name</span><span class="p">;</span>

  <span class="c1">// Serialized value&lt;context&gt;.</span>
  <span class="k">mutable</span> <span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="k">sizeof</span><span class="p">(</span><span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">buffer_context</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;&gt;</span><span class="p">)];</span>

  <span class="n">named_arg_base</span><span class="p">(</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="n">nm</span><span class="p">)</span> <span class="o">:</span> <span class="n">name</span><span class="p">(</span><span class="n">nm</span><span class="p">)</span> <span class="p">{}</span>

  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Context</span><span class="o">&gt;</span> <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">deserialize</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span> <span class="n">arg</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">arg</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">basic_format_arg</span><span class="o">&lt;</span><span class="n">Context</span><span class="o">&gt;</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">arg</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="nl">named_arg</span> <span class="p">:</span> <span class="n">named_arg_base</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="p">{</span>
  <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">;</span>

  <span class="n">named_arg</span><span class="p">(</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">)</span>
      <span class="o">:</span> <span class="n">named_arg_base</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">value</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...,</span> <span class="k">typename</span> <span class="n">S</span><span class="p">,</span> <span class="n">FMT_ENABLE_IF</span><span class="p">(</span><span class="o">!</span><span class="n">is_compile_string</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="n">check_format_string</span><span class="p">(</span><span class="k">const</span> <span class="n">S</span> <span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#if defined(FMT_ENFORCE_COMPILE_STRING)</span>
  <span class="k">static_assert</span><span class="p">(</span><span class="n">is_compile_string</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span>
                <span class="s">&quot;FMT_ENFORCE_COMPILE_STRING requires all format strings to &quot;</span>
                <span class="s">&quot;utilize FMT_STRING() or fmt().&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...,</span> <span class="k">typename</span> <span class="n">S</span><span class="p">,</span> <span class="n">FMT_ENABLE_IF</span><span class="p">(</span><span class="n">is_compile_string</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">check_format_string</span><span class="p">(</span><span class="n">S</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">view</span> <span class="p">{};</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="kt">bool</span><span class="p">...</span><span class="o">&gt;</span> <span class="k">struct</span> <span class="n">bool_pack</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="kt">bool</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
<span class="k">using</span> <span class="n">all_true</span> <span class="o">=</span>
    <span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">bool_pack</span><span class="o">&lt;</span><span class="n">Args</span><span class="p">...,</span> <span class="nb">true</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">bool_pack</span><span class="o">&lt;</span><span class="nb">true</span><span class="p">,</span> <span class="n">Args</span><span class="p">...</span><span class="o">&gt;&gt;</span><span class="p">;</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="p">,</span> <span class="k">typename</span> <span class="n">S</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Char</span> <span class="o">=</span> <span class="n">char_t</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;&gt;</span>
<span class="kr">inline</span> <span class="n">format_arg_store</span><span class="o">&lt;</span><span class="n">buffer_context</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">remove_reference_t</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">...</span><span class="o">&gt;</span>
<span class="n">make_args_checked</span><span class="p">(</span><span class="k">const</span> <span class="n">S</span> <span class="o">&amp;</span><span class="n">format_str</span><span class="p">,</span>
                  <span class="k">const</span> <span class="n">remove_reference_t</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">static_assert</span><span class="p">(</span><span class="n">all_true</span><span class="o">&lt;</span><span class="p">(</span><span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">is_base_of</span><span class="o">&lt;</span><span class="n">view</span><span class="p">,</span> <span class="n">remove_reference_t</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;&gt;</span><span class="p">()</span> <span class="o">||</span>
                          <span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">is_reference</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">())...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span>
                <span class="s">&quot;passing views as lvalues is disallowed&quot;</span><span class="p">);</span>
  <span class="n">check_format_string</span><span class="o">&lt;</span><span class="n">remove_const_t</span><span class="o">&lt;</span><span class="n">remove_reference_t</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;&gt;</span><span class="p">...</span><span class="o">&gt;</span><span class="p">(</span><span class="n">format_str</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">{</span><span class="n">args</span><span class="p">...};</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span>
<span class="n">std</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="n">vformat</span><span class="p">(</span><span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="n">format_str</span><span class="p">,</span>
                                <span class="n">basic_format_args</span><span class="o">&lt;</span><span class="n">buffer_context</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;&gt;</span> <span class="n">args</span><span class="p">);</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span>
<span class="k">typename</span> <span class="n">buffer_context</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;::</span><span class="n">iterator</span>
<span class="n">vformat_to</span><span class="p">(</span><span class="n">buffer</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="n">basic_string_view</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="n">format_str</span><span class="p">,</span>
           <span class="n">basic_format_args</span><span class="o">&lt;</span><span class="n">buffer_context</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;&gt;</span> <span class="n">args</span><span class="p">);</span>
<span class="p">}</span> <span class="c1">// namespace internal</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Char</span> <span class="o">=</span> <span class="n">char_t</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;&gt;</span>
<span class="kr">inline</span> <span class="n">internal</span><span class="o">::</span><span class="n">named_arg</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Char</span><span class="o">&gt;</span> <span class="n">arg</span><span class="p">(</span><span class="k">const</span> <span class="n">S</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">static_assert</span><span class="p">(</span><span class="n">internal</span><span class="o">::</span><span class="n">is_string</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">{</span><span class="n">name</span><span class="p">,</span> <span class="n">arg</span><span class="p">};</span>
<span class="p">}</span>

<span class="c1">// Disable nested named arguments, e.g. ``arg(&quot;a&quot;, arg(&quot;b&quot;, 42))``.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Char</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">arg</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">internal</span><span class="o">::</span><span class="n">named_arg</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">Char</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>

<span class="c1">// GCC 8 and earlier cannot handle std::back_insert_iterator&lt;Container&gt; with</span>
<span class="c1">// vformat_to&lt;ArgFormatter&gt;(...) overload, so SFINAE on iterator type instead.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">OutputIt</span><span class="p">,</span> <span class="k">typename</span> <span class="n">S</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Char</span> <span class="o">=</span> <span class="n">char_t</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">,</span>
          <span class="n">FMT_ENABLE_IF</span><span class="p">(</span>
              <span class="n">internal</span><span class="o">::</span><span class="n">is_contiguous_back_insert_iterator</span><span class="o">&lt;</span><span class="n">OutputIt</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
<span class="n">OutputIt</span> <span class="n">vformat_to</span><span class="p">(</span><span class="n">OutputIt</span> <span class="n">out</span><span class="p">,</span> <span class="k">const</span> <span class="n">S</span> <span class="o">&amp;</span><span class="n">format_str</span><span class="p">,</span>
                    <span class="n">basic_format_args</span><span class="o">&lt;</span><span class="n">buffer_context</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;&gt;</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">using</span> <span class="n">container</span> <span class="o">=</span> <span class="n">remove_reference_t</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">internal</span><span class="o">::</span><span class="n">get_container</span><span class="p">(</span><span class="n">out</span><span class="p">))</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="n">internal</span><span class="o">::</span><span class="n">container_buffer</span><span class="o">&lt;</span><span class="n">container</span><span class="o">&gt;</span> <span class="n">buf</span><span class="p">((</span><span class="n">internal</span><span class="o">::</span><span class="n">get_container</span><span class="p">(</span><span class="n">out</span><span class="p">)));</span>
  <span class="n">internal</span><span class="o">::</span><span class="n">vformat_to</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">to_string_view</span><span class="p">(</span><span class="n">format_str</span><span class="p">),</span> <span class="n">args</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Container</span><span class="p">,</span> <span class="k">typename</span> <span class="n">S</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="p">,</span>
          <span class="n">FMT_ENABLE_IF</span><span class="p">(</span>
              <span class="n">is_contiguous</span><span class="o">&lt;</span><span class="n">Container</span><span class="o">&gt;::</span><span class="n">value</span> <span class="o">&amp;&amp;</span><span class="n">internal</span><span class="o">::</span><span class="n">is_string</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">back_insert_iterator</span><span class="o">&lt;</span><span class="n">Container</span><span class="o">&gt;</span>
<span class="n">format_to</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">back_insert_iterator</span><span class="o">&lt;</span><span class="n">Container</span><span class="o">&gt;</span> <span class="n">out</span><span class="p">,</span> <span class="k">const</span> <span class="n">S</span> <span class="o">&amp;</span><span class="n">format_str</span><span class="p">,</span>
          <span class="n">Args</span> <span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">vformat_to</span><span class="p">(</span>
      <span class="n">out</span><span class="p">,</span> <span class="n">to_string_view</span><span class="p">(</span><span class="n">format_str</span><span class="p">),</span>
      <span class="p">{</span><span class="n">internal</span><span class="o">::</span><span class="n">make_args_checked</span><span class="o">&lt;</span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="n">args</span><span class="p">...)});</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Char</span> <span class="o">=</span> <span class="n">char_t</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;&gt;</span>
<span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span>
<span class="n">vformat</span><span class="p">(</span><span class="k">const</span> <span class="n">S</span> <span class="o">&amp;</span><span class="n">format_str</span><span class="p">,</span> <span class="n">basic_format_args</span><span class="o">&lt;</span><span class="n">buffer_context</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;&gt;</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">internal</span><span class="o">::</span><span class="n">vformat</span><span class="p">(</span><span class="n">to_string_view</span><span class="p">(</span><span class="n">format_str</span><span class="p">),</span> <span class="n">args</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Pass char_t as a default template parameter instead of using</span>
<span class="c1">// std::basic_string&lt;char_t&lt;S&gt;&gt; to reduce the symbol size.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="p">,</span> <span class="k">typename</span> <span class="n">Char</span> <span class="o">=</span> <span class="n">char_t</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;&gt;</span>
<span class="kr">inline</span> <span class="n">std</span><span class="o">::</span><span class="n">basic_string</span><span class="o">&lt;</span><span class="n">Char</span><span class="o">&gt;</span> <span class="n">format</span><span class="p">(</span><span class="k">const</span> <span class="n">S</span> <span class="o">&amp;</span><span class="n">format_str</span><span class="p">,</span> <span class="n">Args</span> <span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">internal</span><span class="o">::</span><span class="n">vformat</span><span class="p">(</span>
      <span class="n">to_string_view</span><span class="p">(</span><span class="n">format_str</span><span class="p">),</span>
      <span class="p">{</span><span class="n">internal</span><span class="o">::</span><span class="n">make_args_checked</span><span class="o">&lt;</span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="n">args</span><span class="p">...)});</span>
<span class="p">}</span>

<span class="n">FMT_API</span> <span class="kt">void</span> <span class="n">vprint</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="n">string_view</span> <span class="n">format_str</span><span class="p">,</span> <span class="n">format_args</span> <span class="n">args</span><span class="p">);</span>
<span class="n">FMT_API</span> <span class="kt">void</span> <span class="nf">vprint</span><span class="p">(</span><span class="n">string_view</span> <span class="n">format_str</span><span class="p">,</span> <span class="n">format_args</span> <span class="n">args</span><span class="p">);</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="p">,</span>
          <span class="n">FMT_ENABLE_IF</span><span class="p">(</span><span class="n">internal</span><span class="o">::</span><span class="n">is_string</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="k">const</span> <span class="n">S</span> <span class="o">&amp;</span><span class="n">format_str</span><span class="p">,</span> <span class="n">Args</span> <span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">vprint</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">to_string_view</span><span class="p">(</span><span class="n">format_str</span><span class="p">),</span>
         <span class="n">internal</span><span class="o">::</span><span class="n">make_args_checked</span><span class="o">&lt;</span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="n">args</span><span class="p">...));</span>
<span class="p">}</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">S</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="p">,</span>
          <span class="n">FMT_ENABLE_IF</span><span class="p">(</span><span class="n">internal</span><span class="o">::</span><span class="n">is_string</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">)</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="k">const</span> <span class="n">S</span> <span class="o">&amp;</span><span class="n">format_str</span><span class="p">,</span> <span class="n">Args</span> <span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">vprint</span><span class="p">(</span><span class="n">to_string_view</span><span class="p">(</span><span class="n">format_str</span><span class="p">),</span>
         <span class="n">internal</span><span class="o">::</span><span class="n">make_args_checked</span><span class="o">&lt;</span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="p">(</span><span class="n">format_str</span><span class="p">,</span> <span class="n">args</span><span class="p">...));</span>
<span class="p">}</span>
<span class="n">FMT_END_NAMESPACE</span>

<span class="cp">#endif </span><span class="c1">// FMT_CORE_H_</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, seq-lang

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>